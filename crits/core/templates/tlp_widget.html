<link rel="stylesheet" href="/css/jquery.simplecolorpicker.css"></style>
<script>
    var tlp_modify = "{% url 'crits.core.views.tlp_modify' %}";
</script>
<tr>
    <td class="key">TLP Sharing</td>
    <td>
        <select name="colorpicker">
            <option value="white" {% if tlp == 'white' %} selected=selected {% endif %}>White</option>
            <optgroup label="----------"></optgroup>
            <option value="green" {% if tlp == 'green' %} selected=selected {% endif %}>Green</option>
            <optgroup label="----------"></optgroup>
            <option value="yellow" {% if tlp == 'amber' %} selected=selected {% endif %}>Amber</option>
            <optgroup label="----------"></optgroup>
            <option value="red" {% if tlp == 'red' %} selected=selected {% endif %}>Red</option>
        </select>
    </td>
</tr>
<script type="text/javascript" src="/js/jquery.simplecolorpicker.js"></script>
<script type="text/javascript">
    $('select[name="colorpicker"]').simplecolorpicker({
        picker: true,
    }).on('change', function(e) {
        // Bit of a hack to prevent the color from switching even if it fails
        // to set properly on the backend.
        var res = modify_tlp('{{subscription.type}}', '{{subscription.id}}', $('select[name="colorpicker"]').val());
        if (!res) {
            $('select[name="colorpicker"]').simplecolorpicker('selectColor', '{{tlp}}');
        };
    });
    $('span.simplecolorpicker.picker').css('background-color', '#bbbbbb')
    .css('min-width', '50px');
</script>
